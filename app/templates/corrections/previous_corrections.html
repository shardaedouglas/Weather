{% extends "base.html" %}
{% block title %}View Previous Corrections{% endblock %}
{% block content %}

<div class="container-md">
  <div class="container-md">
    <div class="row g-3">
      <div class="col g-3">
        <h1>View Previous Corrections</h1>
        <p>This is a brief description.</p>
      </div>
    </div>
  </div>


  <div class="container">
    <div id="spinner" class="spinner-border text-info text-center" style="display:block; margin-left: auto; margin-right: auto; margin-top: 20px;" >
    </div>
    <div class="row">
      <div class="col">
        <div class="table-responsive-lg">
          <table class="table table-light table-striped text-center" id="PrevCorrectionsTable">
            <thead>
              <tr>
                <th class="text-center">User</th>
                <th class="text-center">GHCN ID</th>
                <th class="text-center">Date</th>
                <th class="text-center">Element</th>
                <th class="text-center">Action</th>
                <th class="text-center">O Value</th>
                <th class="text-center">M Flag</th>
                <th class="text-center">Q Flag</th>
                <th class="text-center">S Flag</th>
                <th class="text-center">E Value</th>
                <th class="text-center">E Flag</th>
                <th class="text-center">Source</th>
                <th class="text-center">Submission Date</th>
                <th class="text-center">Datzilla Number</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Custom CSS for PrevCorrectionsTable -->
<style>
#PrevCorrectionsTable {
  table-layout: auto;
  width: 100%;
  min-width: max-content;
}

#PrevCorrectionsTable th,
#PrevCorrectionsTable td {
  white-space: nowrap;
  padding: 8px 12px;
  text-align: center;
}

/* Allow columns to auto-size based on content */
#PrevCorrectionsTable th,
#PrevCorrectionsTable td {
  width: auto;
  min-width: fit-content;
}

/* Ensure table container can handle horizontal scroll if needed */
.table-responsive-lg {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  min-width: 100%;
}

/* Make table wider to accommodate sort buttons */
#PrevCorrectionsTable {
  min-width: 1400px;
  width: max-content;
}

/* Ensure sort buttons are visible */
#PrevCorrectionsTable th {
  position: relative;
  padding-right: 25px; /* Extra space for sort arrows */
}

/* Style for DataTables sort indicators */
#PrevCorrectionsTable th.sorting,
#PrevCorrectionsTable th.sorting_asc,
#PrevCorrectionsTable th.sorting_desc {
  cursor: pointer;
  position: relative;
}

#PrevCorrectionsTable th.sorting:after,
#PrevCorrectionsTable th.sorting_asc:after,
#PrevCorrectionsTable th.sorting_desc:after {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 12px;
}

#PrevCorrectionsTable th.sorting:after {
  content: "↕";
  opacity: 0.5;
}

#PrevCorrectionsTable th.sorting_asc:after {
  content: "↑";
  opacity: 1;
}

#PrevCorrectionsTable th.sorting_desc:after {
  content: "↓";
  opacity: 1;
}

/* Dark mode adjustments */
.dark-mode #PrevCorrectionsTable th,
.dark-mode #PrevCorrectionsTable td {
  border-color: #4a5568;
}

/* High contrast mode adjustments */
.high-contrast #PrevCorrectionsTable th,
.high-contrast #PrevCorrectionsTable td {
  border: 2px solid #000000 !important;
}

.dark-mode.high-contrast #PrevCorrectionsTable th,
.dark-mode.high-contrast #PrevCorrectionsTable td {
  border: 2px solid #ffffff !important;
}

/* Responsive adjustments for smaller screens */
@media (max-width: 1200px) {
  #PrevCorrectionsTable {
    font-size: 0.9rem;
  }
  
  #PrevCorrectionsTable th,
  #PrevCorrectionsTable td {
    padding: 6px 8px;
  }
}

@media (max-width: 768px) {
  #PrevCorrectionsTable {
    font-size: 0.8rem;
  }
  
  #PrevCorrectionsTable th,
  #PrevCorrectionsTable td {
    padding: 4px 6px;
  }
}
</style>

<script>
$(document).ready(function(){
        $('#PrevCorrectionsTable').dataTable({
          pageLength: 25,
        });

        
        updatePrevCorrTable();
        
  });



function updatePrevCorrTable() {
  $('#spinner').show();
  $('#PrevCorrectionsTable').hide();


  $.ajax({
    url: '/corrections/previous/get',
    method: 'GET',
    contentType: 'application/json', 
    // data: data,  // Send data as JSON
    success: function(response) {
        // Handle processing
        // console.log("Correction Data Recieved");
        // console.log(response);
        $('#PrevCorrectionsTable').DataTable().clear().rows.add(response).draw();
        $('#spinner').hide();
        $('#PrevCorrectionsTable').show();
    },
    error: function(xhr, status, error) {
        console.error("Error:", error);
        handleAjaxError(xhr, status, error, "There was an error processing your request.");
        $('#PrevCorrectionsTable').DataTable().clear();
        $('#spinner').hide();
        $('#PrevCorrectionsTable').show();
    }
    });

}
</script>


{% endblock content %}