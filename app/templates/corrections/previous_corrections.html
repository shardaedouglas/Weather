{% extends "base.html" %}
{% block title %}View Previous Corrections{% endblock %}
{% block content %}

<div class="container-md">
  <div class="container-md">
    <div class="row g-3">
      <div class="col g-3">
        <h1>View Previous Corrections</h1>
        <p>This is a brief description.</p>
      </div>
    </div>
  </div>


  <div class="container">
    <div id="spinner" class="spinner-border text-info text-center" style="display:block; margin-left: auto; margin-right: auto; margin-top: 20px;" >
    </div>
    <div class="row">
      <div class="col">
        <div class="table-responsive-lg">
          <table class="table table-light table-striped text-center" id="PrevCorrectionsTable">
            <thead>
              <tr>
                <th class="text-center">User</th>
                <th class="text-center">GHCN ID</th>
                <th class="text-center">Date</th>
                <th class="text-center">Element</th>
                <th class="text-center">Action</th>
                <th class="text-center">O Value</th>
                <th class="text-center">M Flag</th>
                <th class="text-center">Q Flag</th>
                <th class="text-center">S Flag</th>
                <th class="text-center">E Value</th>
                <th class="text-center">E Flag</th>
                <th class="text-center">Source</th>
                <th class="text-center">Submission Date</th>
                <th class="text-center">Datzilla Number</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Custom CSS for PrevCorrectionsTable -->
<style>
#PrevCorrectionsTable {
  width: 100%;
}

#PrevCorrectionsTable th,
#PrevCorrectionsTable td {
  padding: 8px 6px;
  text-align: center;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* Table container styling */
.table-responsive-lg {
  width: 100%;
}

/* DataTables wrapper styling */
.dataTables_wrapper {
  width: 100%;
}

/* Make table fit the container */
#PrevCorrectionsTable {
  width: 100%;
  table-layout: fixed;
}

/* Ensure sort buttons are visible */
#PrevCorrectionsTable th {
  position: relative;
  padding-right: 25px; /* Extra space for sort arrows */
}

/* Style for DataTables sort indicators */
#PrevCorrectionsTable th.sorting,
#PrevCorrectionsTable th.sorting_asc,
#PrevCorrectionsTable th.sorting_desc {
  cursor: pointer;
  position: relative;
}

#PrevCorrectionsTable th.sorting:after,
#PrevCorrectionsTable th.sorting_asc:after,
#PrevCorrectionsTable th.sorting_desc:after {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 12px;
}

#PrevCorrectionsTable th.sorting:after {
  content: "↕";
  opacity: 0.5;
}

#PrevCorrectionsTable th.sorting_asc:after {
  content: "↑";
  opacity: 1;
}

#PrevCorrectionsTable th.sorting_desc:after {
  content: "↓";
  opacity: 1;
}

/* Dark mode adjustments */
.dark-mode #PrevCorrectionsTable {
  background-color: #2d3748;
  color: #e2e8f0;
}

.dark-mode #PrevCorrectionsTable th {
  background-color: #4a5568;
  color: #e2e8f0;
  border-color: #718096;
}

.dark-mode #PrevCorrectionsTable td {
  background-color: #2d3748;
  color: #e2e8f0;
  border-color: #4a5568;
}

.dark-mode #PrevCorrectionsTable tbody tr:hover {
  background-color: #4a5568 !important;
}

.dark-mode #PrevCorrectionsTable tbody tr:nth-child(odd) {
  background-color: #2d3748;
}

.dark-mode #PrevCorrectionsTable tbody tr:nth-child(even) {
  background-color: #374151;
}

/* High contrast mode adjustments */
.high-contrast #PrevCorrectionsTable th,
.high-contrast #PrevCorrectionsTable td {
  border: 2px solid #000000 !important;
}

.dark-mode.high-contrast #PrevCorrectionsTable th,
.dark-mode.high-contrast #PrevCorrectionsTable td {
  border: 2px solid #ffffff !important;
}

/* Responsive adjustments for smaller screens */
@media (max-width: 1200px) {
  #PrevCorrectionsTable {
    font-size: 0.9rem;
  }
  
  #PrevCorrectionsTable th,
  #PrevCorrectionsTable td {
    padding: 6px 8px;
  }
}

@media (max-width: 768px) {
  #PrevCorrectionsTable {
    font-size: 0.8rem;
  }
  
  #PrevCorrectionsTable th,
  #PrevCorrectionsTable td {
    padding: 4px 6px;
  }
}
</style>

<script>
$(document).ready(function(){
        $('#PrevCorrectionsTable').dataTable({
          pageLength: 25,
          scrollX: false,
          autoWidth: true,
          responsive: false,
          columnDefs: [
            { targets: 0, width: "8%", className: 'text-center' },   // User
            { targets: 1, width: "10%", className: 'text-center' },  // GHCN ID
            { targets: 2, width: "8%", className: 'text-center' },   // Date
            { targets: 3, width: "8%", className: 'text-center' },   // Element
            { targets: 4, width: "7%", className: 'text-center' },   // Action
            { targets: 5, width: "7%", className: 'text-center' },   // O Value
            { targets: 6, width: "6%", className: 'text-center' },   // M Flag
            { targets: 7, width: "6%", className: 'text-center' },   // Q Flag
            { targets: 8, width: "6%", className: 'text-center' },   // S Flag
            { targets: 9, width: "7%", className: 'text-center' },   // E Value
            { targets: 10, width: "6%", className: 'text-center' },  // E Flag
            { targets: 11, width: "8%", className: 'text-center' },  // Source
            { targets: 12, width: "10%", className: 'text-center' }, // Submission Date
            { targets: 13, width: "9%", className: 'text-center' }   // Datzilla Number
          ]
        });

        
        updatePrevCorrTable();
        
  });



function updatePrevCorrTable() {
  $('#spinner').show();
  $('#PrevCorrectionsTable').hide();


  $.ajax({
    url: '/corrections/previous/get',
    method: 'GET',
    contentType: 'application/json', 
    // data: data,  // Send data as JSON
    success: function(response) {
        // Handle processing
        // console.log("Correction Data Recieved");
        // console.log(response);
        $('#PrevCorrectionsTable').DataTable().clear().rows.add(response).draw();
        $('#spinner').hide();
        $('#PrevCorrectionsTable').show();
    },
    error: function(xhr, status, error) {
        console.error("Error:", error);
        handleAjaxError(xhr, status, error, "There was an error processing your request.");
        $('#PrevCorrectionsTable').DataTable().clear();
        $('#spinner').hide();
        $('#PrevCorrectionsTable').show();
    }
    });

}
</script>


{% endblock content %}