<div class="container form-container">
    <input type="hidden" id="correctionData" name="correctionData">
    <div class="row">
        <div class="col">
            {# <textarea class="form-control" rows="20"></textarea> #}

            <div class="row " style="text-align: center">
                <div class="col">
                    <div class="table-responsive-lg">
                        <table class="table table-sm table-striped table-borderless border text-center" id="rangeTable">
                            <thead>
                                <tr>
                                    <th class="ghcn-table-cell text-center" scope="col">GHCN ID</th>
                                    <th class="ghcn-table-cell text-center" scope="col">Date</th>
                                    <th class="ghcn-table-cell text-center" scope="col">Element</th>
                                    <th class="ghcn-table-cell text-center" scope="col">Action</th>
                                    <th class="ghcn-table-cell text-center" scope="col">Value</th>
                                    <th class="ghcn-table-cell text-center" scope="col">New Value (Invalidation)</th>
                                    <th class="ghcn-table-cell text-center" scope="col">Today's Date</th>
                                    <th class="ghcn-table-cell text-center" scope="col">Datzilla #</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center" id="button-row">
        <div class="col-sm-3">
            <button type="submit" class="btn btn-success btn-submit w-100 d-block" >Submit Invalidation</button>
        </div>
        <!-- <div class="col-sm">
            <button type="button" class="btn btn-dark ">Cancel</button>
        </div> -->
    </div>
</div>

<script>
    $(document).ready(function(){
        // $('#rangeTable').dataTable();
    });

    $(".btn-submit").click(function () {
        // Show loading spinner
        const loadingSpinner = document.querySelector('#spinner');
        if (loadingSpinner) {
            loadingSpinner.style.display = 'block';
        }
        
        // Disable the submit button to prevent multiple submissions
        $(this).prop('disabled', true);
        
        // Get the stored table data
        const correctionData = JSON.parse($('#correctionData').val());
        console.log(correctionData);
        submitCorrections(correctionData); // Call the submit function separately
    });


    function submitCorrections(correctionData) {
        // Send the correctionData directly in the request
        $.ajax({
            url: '/submit_ranged_corrections',
            method: 'POST',
            contentType: 'application/json',  // Ensure the server handles the data as JSON
            data: JSON.stringify({ correction_data: correctionData }),  // Send data as JSON
            success: function(response) {
                // Hide the loading spinner
                const loadingSpinner = document.querySelector('#spinner');
                if (loadingSpinner) {
                    loadingSpinner.style.display = 'none';
                }
                
                // Re-enable the submit button
                $(".btn-submit").prop('disabled', false);
                
                // Hide the ranged table
                $("#ranged-form-table").hide();
                
                // Handle processing
                handleAjaxSuccess("Ranged Correction Submitted Successfully");
                showSubmissionConfirmation("ranged");
            },
            error: function(xhr, status, error) {
                // Hide the loading spinner
                const loadingSpinner = document.querySelector('#spinner');
                if (loadingSpinner) {
                    loadingSpinner.style.display = 'none';
                }
                
                // Re-enable the submit button
                $(".btn-submit").prop('disabled', false);
                
                console.error("Error:", error);
                handleAjaxError(xhr, status, error, "There was an error processing your ranged correction request.");
            }
        });
    }
</script>