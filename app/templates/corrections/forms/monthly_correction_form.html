{% extends "base.html" %}
{% block title %}Monthly Correction{% endblock %}
{% block content %}

<!--Monthly Form-->
<div class="container-md justify-content-center " id="form-monthly">
    <!-- <div class="container-md justify-content-center form-container" id="form-monthly" style="display:none"> -->
        <div class="container-md">
            <div class="row g-3">
                <div class="col g-3">
                    <h1>Enter a Monthly Correction</h1>
                    <p>This is a brief description of Monthly Corrections.</p>
                </div>
            </div>
        </div>     
    
        <div class="container-md form-container">
        <form class="row g-3 align-items-center">
                <div class="row g-3">
                    <div class="col input-group">
                        <span class="input-group-text" id="inputGroup-sizing-default" >GHCN ID</span>
                        {{monthly_form.ghcn_id(class_='form-control') }}
                    </div>
                    <div class="row g-3">
                        <div class="col input-group" id="date-div" style="justify-content: start;">
                            <span class="input-group-text" id="inputGroup-sizing-default" >Date</span>
                            {{monthly_form.date(class_='form-control date-picker')}}
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center g-3" id="button-row">
                    <div class="col-sm">
                        <button type="reset" class="btn button-dull" style="width:100%;display:block;font-weight: bold;">Clear</button>
                    </div>
                    <div class="col-sm">
                        <!-- <button type="submit" class="btn btn-success" onclick="showMonthTable()" style="width:100%;display:block;font-weight: bold;">Next</button> -->
                        <button type="button" class="btn btn-success" id="monthly-next-btn" style="width:100%;display:block;font-weight: bold;">Next</button>

                    </div>
                    
                </div>
        
        </div>  
        
        <!--Monthly Table -->
        <div id="monthly-form-table" >
            {% include "corrections/data_tables/input_monthly_form.html" %}
            
        </div>
    </form>
    </div>
    
    <div id="submission-element" style="display: none;">
        {% include "corrections/correction_submitted_element.html" %}
    </div>

    <script>
        $(document).ready(function () {

            // First Window Next Button
            $("#monthly-next-btn").click(function() {
                if (!$("#ghcn_id").val() || !$("#date").val()){
                    // Error message: need both values.
                    alert("Both values need to be filled out.");
                } else {
                    showMonthTable();
                }
            });

            $("form").submit(function (event) {
                event.preventDefault();
                console.log($(this));
                // console.log($(this).serialize());

                
                // NOTE that the Element field needs to be replaced with its sub element if the selection is WT** WV** SN*# or SX*#
                // See formatWeatherDataQuery() and checkFields() in daily_correction_form.html
                var formData = formatWeatherDataQuery($(this));
                
                // Code to Process the monthly data.
                console.log(formData);
                // correctionFormHandler(formData, function (output) {
                //     showMonthTable();
                // })
                // Upon Success
                showSubmissionConfirmation("monthly");
            });

             // Showing sub elements for element selection
            $("#element").on("change", function() {
                switch ($("#element").val().toString()) {
                    case "SN*#":
                    $("#sub-element-select").removeClass("d-none");
                    $(".sub-element-option").addClass("d-none");
                    $("#sub_element_SN").parent().removeClass("d-none");
                    break;
                    case "SX*#":
                    $("#sub-element-select").removeClass("d-none");
                    $(".sub-element-option").addClass("d-none");
                    $("#sub_element_SX").parent().removeClass("d-none");
                    break;
                    case "WT**":
                    $("#sub-element-select").removeClass("d-none");
                    $(".sub-element-option").addClass("d-none");
                    $("#sub_element_WT").parent().removeClass("d-none");
                    break;
                    case "WV**":
                    $("#sub-element-select").removeClass("d-none");
                    $(".sub-element-option").addClass("d-none");
                    $("#sub_element_WV").parent().removeClass("d-none");
                    break;
                    

                    default:
                        // console.log("Selected " + $("#element").val().toString() );
                        // sub-element-select
                        $("#sub-element-select").addClass("d-none");
                }
            });

            

        });

        function showMonthTable() {
            document.getElementById('input-monthly-table').style.display = "block";
         }

    </script>

    {% endblock content %}