{% extends "base.html" %}
{% block content %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        // Function to show or hide forms based on selected correction type
        function showSelectedForm() {
            if ($("#correction-option-daily").is(":checked")) {
                $("#form-daily").show();
                $("#form-monthly").hide();
                $("#form-range").hide();
                $("#form-hourly").hide();
            } else if ($("#correction-option-monthly").is(":checked")) {
                $("#form-daily").hide();
                $("#form-monthly").show();
                $("#form-range").hide();
                $("#form-hourly").hide();
            } else if ($("#correction-option-range").is(":checked")) {
                $("#form-daily").hide();
                $("#form-monthly").hide();
                $("#form-range").show();
                $("#form-hourly").hide();
            } else if ($("#correction-option-hourly").is(":checked")) {
                $("#form-daily").hide();
                $("#form-monthly").hide();
                $("#form-range").hide();
                $("#form-hourly").show();
            }
        }
    
        // Initially show the form based on the selected correction type
        showSelectedForm();
    
        // Handle radio button clicks to show the corresponding form
        $("input[name='correction-option']").click(function() {
            showSelectedForm();
        });

        

        // Handle form submission
        $("form").submit(function(event) {
            event.preventDefault();

            // Get the selected correction type
            var selectedCorrectionType = $("input[name='correction-option']:checked").val();
            console.log("selectedCorrectionType", selectedCorrectionType);

            if (selectedCorrectionType) {
                var formData = $(this).serialize(); // Serialize the form data
                formData += `&correction_type=${encodeURIComponent(selectedCorrectionType)}`;
                console.log("formData: ", formData);
                // Send the form data via AJAX
                $.ajax({
                    url: '/process_correction',
                    method: 'POST',
                    data: formData,
                    success: function(response) {
                        // Display the appropriate table
                        console.log("Success:", response);
                        if (selectedCorrectionType === 'Daily Correction') {
                            showComparisonTable(response.filtered_data);
                        } else if (selectedCorrectionType === 'Monthly Correction') {
                            showMonthTable();
                        } else if (selectedCorrectionType === 'Ranged Correction') {
                            showRangeTable();
                        }
                        // NOTE: This needs to be updated for hourly.
                    },
                    error: function(xhr, status, error) {
                        console.error("Error:", error);
                        alert("There was an error processing your request.");
                    }
                });
            }
        });
    
    });
    
    function showMonthTable() {
        document.getElementById('input-monthly-table').style.display = "block";
     }
     function showRangeTable() {
        document.getElementById('ranged-form-table').style.display = "flex";
     }
     //DAILY TABLE
     function showComparisonTable(filteredData) {
        const tableBody = document.querySelector('#correction-comparison-table tbody');
        
        // Clear existing rows in the table
        tableBody.innerHTML = '';
                
        
        //Add to table data.
        if (filteredData) {
            console.log("Data:", filteredData);
    
            const newRow = `
                <tr>
                    <td>Dist</td>
                    <td>Elev</td>
                    <td>${filteredData.station_code}</td>
                    <td>${filteredData.dayMinus}</td>
                    <td>${filteredData.day}</td>
                    <td>${filteredData.dayPlus}</td>
                </tr>
            `;
            tableBody.insertAdjacentHTML('beforeend', newRow);
        }

        // Show the table
        document.getElementById('correction-comparison-table').style.display = "block";
    }
    

    //NOTE: Probably need a showHourlyTable()
    </script>
    

<div>
    <div class="row">
        <div class="col">
            <input class="form-check-input" type="radio" id="correction-option-daily" name="correction-option" value="Daily Correction" {% if selected_form == 'daily' %}checked{% endif %}>
            <label for="daily-correction">Daily Correction</label>
        </div>
    </div>
    
    <div class="row">
        <div class="col">
            <input class="form-check-input" type="radio" id="correction-option-monthly" name="correction-option" value="Monthly Correction" {% if selected_form == 'monthly' %}checked{% endif %}>
            <label for="monthly-correction">Monthly Correction</label>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <input class="form-check-input" type="radio" id="correction-option-range" name="correction-option" value="Ranged Correction" {% if selected_form == 'range' %}checked{% endif %}>
            <label for="range-correction">Ranged Correction</label>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <input class="form-check-input" type="radio" id="correction-option-hourly" name="correction-option" value="Hourly Correction" {% if selected_form == 'range' %}checked{% endif %}>
            <label for="hourly-correction">Hourly Correction</label>
        </div>
    </div>
</div>

<!--Daily Form-->

<div class="container-md justify-content-center" id="form-daily">
    <div class="container-md">
        <div class="row g-3">
            <div class="col g-3">
                <h1>Enter a Daily Correction</h1>
                <p>This is a brief description of Daily Corrections.</p>
            </div>
        </div>
    </div>
    <div class="container-md form-container">
    <form class="row g-3 align-items-center ">
        <div class="row g-3 align-items-center">
            <div class="col input-group">
                <span class="input-group-text" id="inputGroup-sizing-default" style="font-weight: bold" >GHCN ID</span>
                {{daily_form.ghcn_id(class_='form-control')}}
            </div>
        </div>
        <div class="row g-3">
            <div class="col input-group justify-content-start" id="date-div">
                <span class="input-group-text" id="inputGroup-sizing-default" style="font-weight: bold">Date</span>
                {{daily_form.date(class_='form-control date-picker')}}
            </div>
        </div>
        <div class="row g-3" >
            <div class="col input-group" style="width:13%; flex-wrap: nowrap;">
                <span class="input-group-text" id="inputGroup-sizing-default" style="font-weight: bold">Datzilla #</span>
                {{daily_form.datzilla_number(class_='form-control')}}
            </div>
        </div>
        <div class="row g-3" >
            <div class="col-md input-group justify-content-start" style="flex-wrap: nowrap;">
                <span class="input-group-text element-select" id="inputGroup-sizing-default" style="font-weight: bold">Element</span>
                {{daily_form.element(class_='form-select element-select')}}
            </div>
            <div class="col-md input-group justify-content-start" style="flex-wrap: nowrap;">
                <span class="input-group-text" id="inputGroup-sizing-default" style="font-weight: bold">Action</span>
                {{daily_form.action(class_='form-select action-select')}}
            </div>
        </div>
        <div class="row g-3">

            <div class="col-md input-group" style=" flex-wrap: nowrap;">
                <span class="input-group-text" id="inputGroup-sizing-default" style="font-weight: bold">O-Value</span>
                {{daily_form.o_value(class_='form-control')}}
            </div>
            <div class="col-md input-group" style=" flex-wrap: nowrap;">
                <span class="input-group-text" id="inputGroup-sizing-default" style="font-weight: bold">E-Value</span>
                {{daily_form.e_value(class_='form-control')}}
            </div>
        </div>
        
        <div class="row g-3" >
            <div class="col-sm">
                <button type="submit" class="btn button-light" style="width:100%;display:block;font-weight: bold;">Compare</button>
            </div>
            
            <div class="col-sm">
                <button type="submit" class="btn btn-success" onclick="showComparisonTable()" style="width:100%;display:block;">Submit</button>
            </div>

        </div>
        <div class="row g-3" >
            <div class="col-sm">
                <button type="reset" class="btn button-dull" style="width:100%;display:block;font-weight: bold">Clear</button>
            </div>
        </div>
    </form>
</div>


    <div id="correction-comparison-table" style="display:none;">
        {% include "corrections/correction_comparison_table.html" %}
    </div>

</div>

<!--Monthly Form-->
<div class="container-md justify-content-center " id="form-monthly" style="display:none">
<!-- <div class="container-md justify-content-center form-container" id="form-monthly" style="display:none"> -->
    <div class="container-md">
        <div class="row g-3">
            <div class="col g-3">
                <h1>Enter a Monthly Correction</h1>
                <p>This is a brief description of Monthly Corrections.</p>
            </div>
        </div>
    </div>     

    <div class="container-md form-container">
    <form class="row g-3 align-items-center">
            <div class="row g-3">
                <div class="col input-group">
                    <span class="input-group-text" id="inputGroup-sizing-default" >GHCN ID</span>
                    {{monthly_form.ghcn_id(class_='form-control') }}
                </div>
                <div class="row g-3">
                    <div class="col input-group" id="date-div" style="justify-content: start;">
                        <span class="input-group-text" id="inputGroup-sizing-default" >Date</span>
                        {{monthly_form.date(class_='form-control date-picker')}}
                    </div>
                </div>
            </div>
            <div class="row justify-content-center g-3" id="button-row">
                <div class="col-sm">
                    <button type="reset" class="btn btn-dark" style="width:100%;display:block;font-weight: bold;">Clear</button>
                </div>
                <div class="col-sm">
                    <button type="submit" class="btn btn-success" onclick="showMonthTable()" style="width:100%;display:block;font-weight: bold;">Next</button>
                </div>
                
            </div>
        </form>
    </div>  
    
    <!--Monthly Table -->
    <div id="monthly-form-table" >
        {% include "corrections/input_monthly_form.html" %}
    </div>
</div>


<!--Range Form-->
<div class="container-md justify-content-center" id="form-range" style="display:none;">
    <div class="container-md">
        <div class="row g-3">
            <div class="col g-3">
                <h1>Enter a Ranged Correction</h1>
                <p>This is a brief description of Ranged Corrections.</p>
            </div>
        </div>
    </div>   
    <div class="container-md form-container">
        <form class="row g-3 align-items-center" method="POST" action="/process_correction">
            <div class="row g-3">
                <div class="col input-group">
                    <span class="input-group-text" id="inputGroup-sizing-default" >GHCN ID</span>
                    {{range_form.ghcn_id(class_='form-control')}}
                </div>
                
            </div>
            <div class="row g-3">
                <div class="col-md input-group" id="date-div">
                    <span class="input-group-text" id="inputGroup-sizing-default" >Begin Date</span>
                    {{range_form.begin_date(class_='form-control date-picker')}}
                </div>
                <div class="col-md input-group" id="date-div">
                    <span class="input-group-text" id="inputGroup-sizing-default" >End Date</span>
                    {{range_form.end_date(class_='form-control date-picker')}}
                </div>
            </div>
            <div class="row g-3" style="padding-top: 15px; padding-bottom: 15px;">
                <div class="col input-group" style="width:13%; flex-wrap: nowrap;">
                    <span class="input-group-text" id="inputGroup-sizing-default" >Datzilla #</span>
                    {{range_form.datzilla_number(class_='form-control')}}
                </div>
                
            </div>
            <div class="row g-3">
                <div class="col input-group" style="flex-wrap: nowrap;">
                    <span class="input-group-text" id="inputGroup-sizing-default" >Element</span>
                    {{range_form.element(class_='form-select element-select')}}
                </div>
            </div>
            <div class="row g-3">
                <div class="col input-group" style="width:7%; flex-wrap: nowrap;">
                    <span class="input-group-text" id="inputGroup-sizing-default" >Action</span>
                    {{range_form.action(class_='form-select action-select')}}
                </div>
            </div>
            <div class="row justify-content-center g-3" id="button-row">
                <div class="col-sm">
                    <button type="submit" class="btn btn-dark" style="width:100%;display:block;font-weight: bold;">Clear</button>
                </div>
                <div class="col-sm">
                    <button type="submit" class="btn btn-success"  onclick="showRangeTable()" style="width:100%;display:block;font-weight: bold;">Next</button>
                </div>
                
            </div>
        </form>
    </div>

    <div id="ranged-form-table" style="display:none;">
        {% include "corrections/input_ranged_form.html" %}
    </div>
</div>

<!-- Hourly Form -->

<div class="container-md justify-content-center m-5" id="form-hourly">
    <div class="container-md">
        <div class="row g-3">
            <div class="col g-3">
                <h1>Enter a Hourly Correction</h1>
                <p>This is a brief description of Hourly Corrections.</p>
            </div>
        </div>
    </div>
    <div class="container-md form-container">
        <form class="row g-3 align-items-center ">
            <div class="row g-3 align-items-center">
                <div class="col input-group">
                    <span class="input-group-text" id="inputGroup-sizing-default" style="font-weight: bold">GHCN
                        ID</span>
                    <!-- {{daily_form.ghcn_id(class_='form-control')}} -->
                </div>
            </div>
            <div class="row g-3">
                <div class="col input-group justify-content-start" id="date-div">
                    <span class="input-group-text" id="inputGroup-sizing-default" style="font-weight: bold">Date</span>
                    <!-- {{daily_form.date(class_='form-control date-picker')}} -->
                </div>
            </div>
            <div class="row g-3">
                <div class="col input-group" style="width:13%; flex-wrap: nowrap;">
                    <span class="input-group-text" id="inputGroup-sizing-default" style="font-weight: bold">Datzilla
                        #</span>
                    <!-- {{daily_form.datzilla_number(class_='form-control')}} -->
                </div>
            </div>
            <div class="row g-3">
                <div class="col-sm input-group justify-content-start" style="flex-wrap: nowrap;">
                    <span class="input-group-text element-select" id="inputGroup-sizing-default"
                        style="font-weight: bold">Element</span>
                    <!-- {{daily_form.element(class_='form-select element-select')}} -->
                </div>
                <div class="col-sm input-group justify-content-start" style="width:7%; flex-wrap: nowrap;">
                    <span class="input-group-text" id="inputGroup-sizing-default"
                        style="font-weight: bold">Action</span>
                    <!-- {{daily_form.action(class_='form-select action-select')}} -->
                </div>
            </div>
            <div class="row g-3">

                <div class="col input-group" style="width:13%; flex-wrap: nowrap;">
                    <span class="input-group-text" id="inputGroup-sizing-default"
                        style="font-weight: bold">O-Value</span>
                    <!-- {{daily_form.o_value(class_='form-control')}} -->
                </div>
                <div class="col input-group" style="width:13%; flex-wrap: nowrap;">
                    <span class="input-group-text" id="inputGroup-sizing-default"
                        style="font-weight: bold">E-Value</span>
                    <!-- {{daily_form.e_value(class_='form-control')}} -->
                </div>
            </div>

            <div class="row g-3">
                <div class="col">
                    <button type="submit" class="btn button-light"
                        style="width:100%;display:block;font-weight: bold;">Compare</button>
                </div>

                <div class="col">
                    <button type="submit" class="btn btn-success" onclick=""
                        style="width:100%;display:block;">Submit</button>
                </div>

            </div>
            <div class="row g-3">
                <div class="col-sm">
                    <button type="reset" class="btn button-dull"
                        style="width:100%;display:block;font-weight: bold">Clear</button>
                </div>
            </div>
        </form>
    </div>


    <!-- Showing the data table would go here. -->

</div>

{% endblock content %}